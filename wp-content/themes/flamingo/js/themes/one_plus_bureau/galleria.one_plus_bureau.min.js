(function ($) {
	var a = $.noConflict();

    Galleria.addTheme({
        name: "one_plus_bureau",
        author: "VKW",
        //css: "galleria.one_plus_bureau.css",
        defaults: {
            debug: 'false',
            transition: 'slide',
            easing: "galleriaOut",
            responsive: true,
            imageCrop: 'landscape',
            imagePan: false,
            swipe: true,
            thumbCrop: "height",
            maxScaleRatio: 1,
            maxVideoSize: 0,
            trueFullscreen: !1,
            _hideDock: Galleria.TOUCH ? !1 : !0,
            _closeOnClick: !1,
            _closeButton: '<span class="galleria-close-wrapper gal-handler"><a class="gal-close-btn" href="#"><i class="icon-remove"></i></a></span>',
            _singleInfoButton: '<span class="galleria-single-info-btn-wrapper gal-control gal-handler"><a class="gal-single-info-btn" href="#"><i class="icon-plus"></i></a></span>',
            _fitContentButton: '<span class="galleria-toggle-fit gal-control gal-handler"><a class="btn-toggle-fit" href="#"><i class="icon-resize-full"></i></a></span>',
            _briefTag: '<span class="galleria-brief-tag">Brief</span>'
        },
        init: function (b) {
            Galleria.requires(1.28, "This is a warning. Contact to VanKarWai if needed"),
            this.addElement("thumbnails-tab"), this.appendChild("thumbnails-container", "thumbnails-tab");
            var c = this.$("thumbnails-tab"),
                d = this.$("loader"),
                e = this.$("thumbnails-container"),
                f = this.$("thumbnails-list"),
                g = this.$("info-text"),
                h = this.$("info"),
                xx = this.$("image-nav-right"),
                xy = this.$("image-nav-left"),
                xz = this.$("thumbnails-tab"),
                i = !b._hideDock,
                j = 0;

        if( $("body").hasClass("project-size-dynamic") ){
            this.append({
                'stage' : [b._closeButton, b._fitContentButton, b._singleInfoButton]
            });
        }else{
            this.append({
                'stage' : [b._closeButton, b._singleInfoButton]
            });
        }

        xx.append('<i class="icon-angle-right"></i>');
        xy.append('<i class="icon-angle-left"></i>');
        xz.append('<i class="icon-double-angle-up"></i>');

        this.$("image-nav-left, image-nav-right").addClass("gal-control");

        $('.galleria-info').css("display", "block");

        //check if gallery info layer is empty
        checkMainInfoGallery = function(){
            var infoContent = $(".galleria-layer").find("p");
        };
        checkMainInfoGallery();

        setInfo = function() {
            setTimeout(function() { //Event listens every 500ms in order to save CPU process
                //get project description
                $(".info-box-description p").clone().appendTo(".galleria-layer");
            }, 1400);
        };

        //functions to display info brief for galleries
        //these effects are only for bureau gallery mode
        showInfo = function () {

            stageWidth = $('body').width();
            stageHeight = $('body').height();

            $(".galleria-single-info-btn-wrapper").addClass("info-opened");
            $('.galleria-layer').fadeTo("3000", 1);
            $(".galleria-close-wrapper, .galleria-thumbnails-tab").fadeOut(100);

            $('.galleria-layer > *').css("left", -stageWidth);

            $('.social-sh-menu').animate({left: -35}, 250, 'easeInOutQuart');
            $('.galleria-image-nav-right').animate({left: -35}, 350, 'easeInOutQuart');
            $('.galleria-image-nav-left').animate({left: -35}, 450, 'easeInOutQuart');
            $('.galleria-toggle-fit').animate({left: -35}, 550, 'easeInOutQuart');
            $('.galleria-close-wrapper').animate({top: -350}, 750, 'easeInOutQuart');
            $('.galleria-info').animate({left: -stageWidth}, 750, 'easeInOutQuart');
            $('.galleria-layer > *').animate({left: "35px"}, 500, 'easeInOutQuart');
            $('.galleria-thumbnails-tab').animate({top: stageHeight}, 500, 'easeInOutQuart');
            return false;
        },
        hideInfo = function() {
            $(".galleria-single-info-btn-wrapper").removeClass("info-opened");
            $('.galleria-layer').fadeTo("3000", 0);
            $(".galleria-close-wrapper, .galleria-thumbnails-tab").fadeIn(250);

            $('.social-sh-menu ').animate({left: 0}, 250, 'easeInOutQuart');
            $('.galleria-image-nav-right').animate({left:0}, 350, 'easeInOutQuart');
            $('.galleria-image-nav-left').animate({left: 0}, 450, 'easeInOutQuart');
            $('.galleria-toggle-fit').animate({left: 0}, 550, 'easeInOutQuart');
            $('.galleria-close-wrapper').animate({top: 0}, 750, 'easeInOutQuart');
            $('.galleria-info').animate({left: "85px"}, 750, 'easeInOutQuart');
            $('.galleria-layer > *').animate({paddingLeft: -stageWidth}, 250, 'easeInOutQuart');
            $('.galleria-thumbnails-tab').animate({top: "-25px"}, 500, 'easeInOutQuart');
            return false;
        };

        var state = false;
        $(".gal-single-info-btn").click(function(e){
            if(!state){
               showInfo();
            } else {
               hideInfo();
            }
            state = !state;
            e.preventDefault();
        });

        //centering gallery controls
        centerGalControl = function() {
            var stageHeight = $('body').height(),
                //all the gallery controls must to have the
                //same width to center correctly
                controlHeight = $('.gal-control').height(),
                numControls = $('.gal-control').length;
                controlBlockHeight = (controlHeight*numControls)/2;

                middleStage = (stageHeight/2)-controlBlockHeight;

                $(".gal-control").css("top", middleStage);
                $(".gal-control").each(function(index){
                    var indexControl = index;
                    $(this).css("margin-top", controlHeight*index);
                });
        };
        setTimeout(function() {
            centerGalControl();
        }, 250);
        

        //centering gallery project brief in layer
        centerGalBrief = function() {
            var stageHeight = $('body').height(),
                contentHeight = $('.galleria-layer > *').height();
                var sum=0;
                $('.galleria-layer > *').each( function(){ sum += $(this).height(); });
                $('.galleria-layer > *').first().css("margin-top", -sum/2);
        };
        //fire the function on click info button within the gallery
        $(".gal-single-info-btn").click(function(){
            centerGalBrief();
        });

        showCounter = function(){
            $(".galleria-counter").stop(true).fadeIn(250, function(){
                $(".galleria-counter").delay(1000).fadeOut(750);
            });
        };

        //This function controls the display
        //for the single description for each slide
        //if there is not content, hide the  element
        checkGalInfoContent = function(){
            var theContentInfo = $(".galleria-info").find(".galleria-info-description").text();
            if( theContentInfo.length > 0 ){
                $(".galleria-info").fadeIn(250);
            }else{
                $(".galleria-info").css("display", "none");
            }

        };

        $(window).resize(function(){
            centerGalControl();
        });

            Galleria.IE && (this.addElement("iefix"), this.appendChild("container", "iefix"), this.$("iefix").css({
                zIndex: 3,
                position: "absolute",
                backgroundColor: "#000",
                opacity: 0.4,
                top: 0
            })), b.thumbnails === !1 && e.hide();
            var k = this.proxy(function (b) {
                if (!b && !b.width) return;
                var c = Math.min(b.width, a(window).width());
                //g.width(c - 40), Galleria.IE && this.getOptions("showInfo") && this.$("iefix").width(h.outerWidth()).height(h.outerHeight());
            });
            this.bind("rescale", function () {
                j = this.getStageHeight() - c.height() - 2, e.css("top", i ? j - f.outerHeight() + 2 : j);
                var a = this.getActiveImage();
                a && k(a)
            }), this.bind("loadstart", function (b) {
                showCounter();
                b.cached || d.show().fadeTo(100, 1), a(b.thumbTarget).css("opacity", 1).parent().siblings().children().css("opacity", 0.6);
            }), this.bind("loadfinish", function (a) {
                checkGalInfoContent();
                setInfo();
                d.fadeOut(300), this.$("iefix").toggle(this.hasInfo());
            }), this.bind("image", function (a) {
                $(".galleria-project-title-overlay, .ini-gal-preloader").delay(1500).fadeOut(500);
                k(a.imageTarget);
            }), this.bind("thumbnail", function (d) {
                a(d.thumbTarget).parent(":not(.active)").children().css("opacity", 0.6), a(d.thumbTarget).click(function () {
                    i && b._closeOnClick && c.click();
                });
            }), this.trigger("rescale"), Galleria.TOUCH || (this.addIdleState(e, {
                opacity: 1
            // }), this.addIdleState(this.get("info"), {
            //     opacity: 0
            })), Galleria.IE && this.addIdleState(this.get("iefix"), {
                opacity: 0
            }), this.$("image-nav-left, image-nav-right").css("opacity", 1).hover(function () {
                a(this).animate({
                    opacity: 1
                }, 100);
            }, function () {
                a(this).animate({
                    opacity: 1
                });
            }).show(), b._hideDock ? e.hover(this.proxy(function () { //if set c.click() instead e.hover the thumbs open on click
                c.toggleClass("open", !i), i ? e.animate({
                    top: j
                }, 400, b.easing) : e.animate({
                    top: j - f.outerHeight() + 2
                }, 400, b.easing), i = !i
            })) : (this.bind("thumbnail", function () {
                e.css("top", j - f.outerHeight() + 2);
            }), c.css("visibility", "hidden")), this.$("thumbnails").children().hover(function () {
                a(this).not(".active").children().stop().fadeTo(100, 1);
            }, function () {
                a(this).not(".active").children().stop().fadeTo(400, 0.6);
            }), this.enterFullscreen(), this.attachKeyboard({
                escape: function (a) {
                    return !1;
                },
                up: function (a) {
                    i || c.click(), a.preventDefault()
                },
                down: function (a) {
                    i && c.click(), a.preventDefault()
                }
            });
        }
    });
})(jQuery);